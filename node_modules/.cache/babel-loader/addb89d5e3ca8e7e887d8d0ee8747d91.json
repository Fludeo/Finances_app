{"ast":null,"code":"import _objectSpread from\"C:/Users/noah1/Documents/GitHub/Finances_app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/noah1/Documents/GitHub/Finances_app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/noah1/Documents/GitHub/Finances_app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\noah1\\\\Documents\\\\GitHub\\\\Finances_app\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useEffect,useState}from\"react\";import{useLocation,useNavigate}from\"react-router-dom\";import getCategories from\"../../../helper_functions/getCategories\";import{USDConverter}from\"../../../helper_functions/toCurrency\";import'../../styles/logged_page/crud_page/crud_record_table.css';import{BiEdit}from'react-icons/bi';import{MdDeleteForever}from'react-icons/md';import Modal from\"../../common/Modal\";import EditRecordForm from\"./EditForm\";import ConfirmDeleteForm from\"./ConfirmDeleteForm\";import FormatDate from\"../../../helper_functions/formatDate\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";var CrudRecordTable=function CrudRecordTable(_ref){var token=_ref.token,type=_ref.type;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),tableData=_useState2[0],setTableData=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),filter=_useState4[0],setFilter=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),editModal=_useState6[0],setEditModal=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),deleteModal=_useState8[0],setDeleteModal=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),newRecordModal=_useState10[0],setNewRecordModal=_useState10[1];var _useState11=useState({}),_useState12=_slicedToArray(_useState11,2),formData=_useState12[0],setFormData=_useState12[1];var location=useLocation();var navigate=useNavigate();var NewRecord=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var rawResponse,content;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;_context.next=4;return fetch(\"\".concat(process.env.REACT_APP_PUBLIC_URL_API,\"/record/new/\"),{method:'POST',headers:{'Accept':'application/json','Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify(formData)});case 4:rawResponse=_context.sent;if(!rawResponse.ok){_context.next=11;break;}setNewRecordModal(false);setFormData({});navigate(location.pathname);_context.next=16;break;case 11:_context.next=13;return rawResponse.json();case 13:content=_context.sent;setFormData(_objectSpread(_objectSpread({},formData),{},{errorMessage:content.message}));throw new Error(content.message);case 16:_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](1);console.log(_context.t0);case 21:case\"end\":return _context.stop();}}},_callee,null,[[1,18]]);}));return function NewRecord(_x){return _ref2.apply(this,arguments);};}();var EditRecord=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(e){var rawResponse,content;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();_context2.prev=1;_context2.next=4;return fetch(\"\".concat(process.env.REACT_APP_PUBLIC_URL_API,\"/record/update/\"),{method:'PUT',headers:{'Content-Type':'application/json','Authorization':\"Bearer \".concat(token)},body:JSON.stringify(formData)});case 4:rawResponse=_context2.sent;if(!rawResponse.ok){_context2.next=11;break;}setEditModal(false);setFormData({});navigate(location.pathname);_context2.next=16;break;case 11:_context2.next=13;return rawResponse.json();case 13:content=_context2.sent;setFormData(_objectSpread(_objectSpread({},formData),{},{errorMessage:content.message}));throw new Error(content.message);case 16:_context2.next=21;break;case 18:_context2.prev=18;_context2.t0=_context2[\"catch\"](1);console.log(_context2.t0);case 21:case\"end\":return _context2.stop();}}},_callee2,null,[[1,18]]);}));return function EditRecord(_x2){return _ref3.apply(this,arguments);};}();var handleDeleteSubmit=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){var rawResponse,content;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();_context3.prev=1;_context3.next=4;return fetch(\"\".concat(process.env.REACT_APP_PUBLIC_URL_API,\"/record/delete/\").concat(formData.id),{method:'DELETE',headers:{'Authorization':\"Bearer \".concat(token)},body:JSON.stringify(formData)});case 4:rawResponse=_context3.sent;if(!rawResponse.ok){_context3.next=11;break;}setDeleteModal(false);setFormData({});navigate(location.pathname);_context3.next=16;break;case 11:_context3.next=13;return rawResponse.json();case 13:content=_context3.sent;setFormData(_objectSpread(_objectSpread({},formData),{},{errorMessage:content.message}));throw new Error(content.message);case 16:_context3.next=21;break;case 18:_context3.prev=18;_context3.t0=_context3[\"catch\"](1);console.log(_context3.t0);case 21:case\"end\":return _context3.stop();}}},_callee3,null,[[1,18]]);}));return function handleDeleteSubmit(_x3){return _ref4.apply(this,arguments);};}();useEffect(function(){if(token==='')return;fetch(\"\".concat(process.env.REACT_APP_PUBLIC_URL_API,\"/record/get/type/\").concat(type,\"/category/\").concat(filter),{method:'GET',headers:{'Authorization':\"Bearer \".concat(token)}}).then(function(res){return res.json();}).then(function(res){return setTableData(res.records);}).catch(function(err){return console.log(err);});},[location,filter]);return/*#__PURE__*/_jsxs(\"div\",{className:\"crud-table-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"crud-table__filter-container\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:function onClick(){return setNewRecordModal(true);},className:\"table__new-button table__new-button--hover\",children:[\"New \",type]}),/*#__PURE__*/_jsxs(\"select\",{defaultValue:filter,onChange:function onChange(e){return setFilter(e.currentTarget.value);},className:\"crud-table__filter\",children:[/*#__PURE__*/_jsx(\"option\",{value:'',children:\"No filter\"}),getCategories()[type].map(function(category){return/*#__PURE__*/_jsx(\"option\",{value:category,children:category},category);})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"crud-table-wrapper\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"crud-mobile-table\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"crud-mobile-table__head\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"crud-mobile-table__header-amount\",children:/*#__PURE__*/_jsx(\"p\",{children:\"AMOUNT\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"crud-mobile-table__header-concept\",children:/*#__PURE__*/_jsx(\"p\",{children:\"CONCEPT\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"crud-mobile-table__header-type\",children:/*#__PURE__*/_jsx(\"p\",{children:\"TYPE\"})})]}),tableData!==null&&tableData.map(function(record){return/*#__PURE__*/_jsxs(\"div\",{className:\"crud-mobile-table__card \",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"crud-mobile-table__card-amount\",children:[/*#__PURE__*/_jsx(\"p\",{children:USDConverter(record.amount)}),/*#__PURE__*/_jsx(\"p\",{children:new Date(record.date).toLocaleDateString()})]}),/*#__PURE__*/_jsx(\"div\",{className:\"crud-mobile-table__card-concept\",children:/*#__PURE__*/_jsx(\"p\",{children:record.concept})}),/*#__PURE__*/_jsxs(\"div\",{className:\"crud-mobile-table__card-type\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:record.type==='income'?\"crud-mobile-table__type-income\":\"crud-mobile-table__type-outgo\",children:/*#__PURE__*/_jsx(\"p\",{children:record.type})}),/*#__PURE__*/_jsx(\"p\",{children:record.category})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(BiEdit,{onClick:function onClick(){setFormData(record);setEditModal(true);},className:\"crud-table__edit-icon crud-table__edit-icon--hover\"}),/*#__PURE__*/_jsx(MdDeleteForever,{onClick:function onClick(){setFormData(record);setDeleteModal(true);},className:\"crud-table__delete-icon crud-table__delete-icon--hover\"})]})]})]},record.id);})]}),/*#__PURE__*/_jsxs(\"table\",{className:\"crud-table\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"crud-table__head\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"CONCEPT\"}),/*#__PURE__*/_jsx(\"th\",{children:\"AMOUNT\"}),/*#__PURE__*/_jsx(\"th\",{children:\"TYPE\"}),/*#__PURE__*/_jsx(\"th\",{children:\"CATEGORY\"}),/*#__PURE__*/_jsx(\"th\",{children:\"DATE\"}),/*#__PURE__*/_jsx(\"th\",{children:\"EDIT\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:tableData!==null&&tableData.map(function(record){return/*#__PURE__*/_jsxs(\"tr\",{className:\"crud-table__data-row\",children:[/*#__PURE__*/_jsx(\"td\",{children:record.concept}),/*#__PURE__*/_jsx(\"td\",{children:USDConverter(record.amount)}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"p\",{className:record.type==='income'?\"crud-table__type-income\":\"crud-table__type-outcome\",children:record.type})}),/*#__PURE__*/_jsx(\"td\",{children:record.category}),/*#__PURE__*/_jsx(\"td\",{children:FormatDate(record.date)}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(BiEdit,{onClick:function onClick(){setFormData(record);setEditModal(true);},className:\"crud-table__edit-icon crud-table__edit-icon--hover\"}),/*#__PURE__*/_jsx(MdDeleteForever,{onClick:function onClick(){setFormData(record);setDeleteModal(true);},className:\"crud-table__delete-icon crud-table__delete-icon--hover\"})]})]},record.id);})})]}),/*#__PURE__*/_jsx(Modal,{trigger:newRecordModal,children:/*#__PURE__*/_jsx(EditRecordForm,{UpdateForm:function UpdateForm(payload){return setFormData(payload);},closeForm:function closeForm(){setFormData({});setNewRecordModal(false);},handleSubmit:function handleSubmit(e){return NewRecord(e);},type:type,formData:_objectSpread(_objectSpread({},formData),{},{id:undefined,type:type})})}),/*#__PURE__*/_jsx(Modal,{trigger:editModal,children:/*#__PURE__*/_jsx(EditRecordForm,{UpdateForm:function UpdateForm(payload){return setFormData(payload);},formData:formData,closeForm:function closeForm(){setFormData({});setEditModal(false);},handleSubmit:function handleSubmit(e){return EditRecord(e);},type:type})}),/*#__PURE__*/_jsx(Modal,{trigger:deleteModal,children:/*#__PURE__*/_jsx(ConfirmDeleteForm,{handleDelete:function handleDelete(e){return handleDeleteSubmit(e);},formData:formData,close:function close(){setFormData({});setDeleteModal(false);}})})]})]});};export default CrudRecordTable;","map":{"version":3,"sources":["C:/Users/noah1/Documents/GitHub/Finances_app/src/components/logged_page/crud_page/CrudRecordTable.tsx"],"names":["React","useEffect","useState","useLocation","useNavigate","getCategories","USDConverter","BiEdit","MdDeleteForever","Modal","EditRecordForm","ConfirmDeleteForm","FormatDate","CrudRecordTable","token","type","tableData","setTableData","filter","setFilter","editModal","setEditModal","deleteModal","setDeleteModal","newRecordModal","setNewRecordModal","formData","setFormData","location","navigate","NewRecord","e","preventDefault","fetch","process","env","REACT_APP_PUBLIC_URL_API","method","headers","body","JSON","stringify","rawResponse","ok","pathname","json","content","errorMessage","message","Error","console","log","EditRecord","handleDeleteSubmit","id","then","res","records","catch","err","currentTarget","value","map","category","record","amount","Date","date","toLocaleDateString","concept","payload","undefined"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\"\r\nimport { useLocation, useNavigate } from \"react-router-dom\"\r\nimport getCategories from \"../../../helper_functions/getCategories\"\r\nimport { USDConverter } from \"../../../helper_functions/toCurrency\"\r\nimport { Record, RecordFormType } from \"../../../types/types\"\r\nimport '../../styles/logged_page/crud_page/crud_record_table.css'\r\nimport {BiEdit} from 'react-icons/bi'\r\nimport  {MdDeleteForever} from 'react-icons/md'\r\nimport Modal from \"../../common/Modal\"\r\nimport EditRecordForm from \"./EditForm\"\r\nimport ConfirmDeleteForm from \"./ConfirmDeleteForm\"\r\nimport  FormatDate from \"../../../helper_functions/formatDate\"\r\n\r\n\r\ntype props ={\r\n    token:string\r\n    type: 'income'|'outgo'\r\n\r\n}\r\n\r\nconst CrudRecordTable = ({token,type}:props) =>{\r\nconst [tableData,setTableData] = useState<Array<Record>|null>(null)\r\nconst [filter,setFilter] = useState<string>('')\r\nconst [editModal,setEditModal] = useState<boolean>(false)\r\nconst [deleteModal,setDeleteModal] = useState<boolean>(false)\r\nconst [newRecordModal,setNewRecordModal] = useState<boolean>(false)\r\nconst [formData,setFormData] = useState<RecordFormType>({} as RecordFormType)\r\nconst location = useLocation()\r\nconst navigate = useNavigate()\r\n \r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\nconst NewRecord = async (e:React.MouseEvent<HTMLButtonElement, MouseEvent>) =>{\r\n    e.preventDefault()\r\n\r\n    \r\n\r\n    try{\r\n        const rawResponse = await fetch(`${process.env.REACT_APP_PUBLIC_URL_API}/record/new/`,{\r\n            method: 'POST',\r\n            headers: {\r\n              'Accept': 'application/json',\r\n              'Content-Type': 'application/json',\r\n              'Authorization' :`Bearer ${token}`,\r\n            },\r\n            body: JSON.stringify(formData)\r\n          }); \r\n          if(rawResponse.ok){\r\n       \r\n          setNewRecordModal(false)\r\n          setFormData({} as RecordFormType)\r\n          navigate(location.pathname)\r\n        }\r\n        else{\r\n            const content = await rawResponse.json()\r\n            setFormData({...formData, errorMessage:content.message})\r\n            throw new Error(content.message)\r\n        }\r\n        }\r\n        catch(err){\r\n            console.log(err)\r\n        }\r\n}\r\n\r\n\r\n\r\n\r\nconst EditRecord = async (e:React.MouseEvent<HTMLButtonElement, MouseEvent>) =>{\r\n    e.preventDefault()\r\n\r\n    try{\r\n        const rawResponse = await fetch(`${process.env.REACT_APP_PUBLIC_URL_API}/record/update/`,{ method: 'PUT',\r\n        headers: {\r\n            'Content-Type': 'application/json',    \r\n            'Authorization' :`Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify(formData)}); \r\n          if(rawResponse.ok){\r\n       \r\n          setEditModal(false)\r\n          setFormData({} as RecordFormType)\r\n          navigate(location.pathname)\r\n        }\r\n        else{\r\n            const content = await rawResponse.json()\r\n            setFormData({...formData, errorMessage:content.message})\r\n            throw new Error(content.message)\r\n        }\r\n        }\r\n        catch(err){\r\n            console.log(err)\r\n        }\r\n}\r\n\r\nconst handleDeleteSubmit= async (e:React.MouseEvent<HTMLButtonElement, MouseEvent>) =>{\r\n    e.preventDefault()\r\n\r\n    try{\r\n        const rawResponse = await fetch(`${process.env.REACT_APP_PUBLIC_URL_API}/record/delete/${formData.id}`,{ method: 'DELETE',\r\n        headers: {  \r\n            'Authorization' :`Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify(formData)}); \r\n          if(rawResponse.ok){\r\n       \r\n          setDeleteModal(false)\r\n          setFormData({} as RecordFormType)\r\n          navigate(location.pathname)\r\n        }\r\n        else{\r\n            const content = await rawResponse.json()\r\n            setFormData({...formData, errorMessage:content.message})\r\n            throw new Error(content.message)\r\n        }\r\n        }\r\n        catch(err){\r\n            console.log(err)\r\n        }\r\n}\r\n\r\n\r\n\r\nuseEffect(()=>{\r\n    if(token==='')return\r\n    fetch(`${process.env.REACT_APP_PUBLIC_URL_API}/record/get/type/${type}/category/${filter}`,{ method: 'GET',\r\n    headers: {\r\n    'Authorization' :`Bearer ${token}`,\r\n    }})\r\n    .then(res=>res.json())\r\n    .then(res=>setTableData(res.records))\r\n    .catch(err=>console.log(err))\r\n\r\n},[location,filter])\r\n\r\n    return(\r\n        <div className=\"crud-table-container\">\r\n            <div className=\"crud-table__filter-container\">\r\n                <button onClick={()=>setNewRecordModal(true)} className=\"table__new-button table__new-button--hover\">New {type}</button>\r\n               <select defaultValue={filter} onChange={(e)=>setFilter(e.currentTarget.value)} className=\"crud-table__filter\">\r\n              <option  value={''}>No filter</option>\r\n            {getCategories()[type].map(category=><option key={category} value={category}>{category}</option>)}             \r\n            </select>\r\n            </div>\r\n            <div className=\"crud-table-wrapper\">\r\n        <div className=\"crud-mobile-table\">\r\n            <div className=\"crud-mobile-table__head\"> \r\n                <div className=\"crud-mobile-table__header-amount\"><p>AMOUNT</p></div>\r\n                <div className=\"crud-mobile-table__header-concept\"><p>CONCEPT</p></div>\r\n                <div className=\"crud-mobile-table__header-type\"><p>TYPE</p></div>\r\n            </div>\r\n          {tableData!==null&&tableData.map((record)=>   \r\n          <div className=\"crud-mobile-table__card \" key={record.id}>\r\n                <div className=\"crud-mobile-table__card-amount\">\r\n                    <p>{USDConverter(record.amount)}</p>\r\n                    <p>{new Date(record.date).toLocaleDateString()}</p>\r\n                </div>\r\n                <div className=\"crud-mobile-table__card-concept\">\r\n                    <p>{record.concept}</p>\r\n                </div>\r\n                <div className=\"crud-mobile-table__card-type\">\r\n                    <div>\r\n                    <div className={record.type==='income'?\"crud-mobile-table__type-income\":\"crud-mobile-table__type-outgo\"}><p>{record.type}</p></div>\r\n                    <p>{record.category}</p>\r\n                    </div>\r\n                    <div>\r\n                    <BiEdit onClick={()=>{setFormData(record as RecordFormType)\r\n                                              setEditModal(true)}} \r\n                                              className=\"crud-table__edit-icon crud-table__edit-icon--hover\" ></BiEdit> \r\n                        <MdDeleteForever onClick={()=>{setFormData(record as RecordFormType)\r\n                                                        setDeleteModal(true)}} className=\"crud-table__delete-icon crud-table__delete-icon--hover\" ></MdDeleteForever>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n        \r\n        <table className=\"crud-table\">\r\n            <thead className=\"crud-table__head\">\r\n                <tr>\r\n                    <th>CONCEPT</th>\r\n                    <th>AMOUNT</th>\r\n                    <th>TYPE</th>\r\n                    <th>CATEGORY</th>\r\n                    <th>DATE</th>\r\n                    <th>EDIT</th>\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n            {tableData!==null&&tableData.map((record)=>\r\n                <tr className=\"crud-table__data-row\" key={record.id}>\r\n                    <td>{record.concept}</td>\r\n                    <td>{USDConverter(record.amount)}</td>\r\n                    <td><p className={record.type==='income'?\"crud-table__type-income\":\"crud-table__type-outcome\"}>{record.type}</p></td>\r\n                    <td>{record.category}</td>\r\n                    <td>{FormatDate(record.date)}</td>\r\n                    <td>\r\n                        <BiEdit onClick={()=>{setFormData(record as RecordFormType)\r\n                                              setEditModal(true)}} \r\n                                              className=\"crud-table__edit-icon crud-table__edit-icon--hover\" ></BiEdit> \r\n                        <MdDeleteForever onClick={()=>{setFormData(record as RecordFormType)\r\n                                                        setDeleteModal(true)}} className=\"crud-table__delete-icon crud-table__delete-icon--hover\" ></MdDeleteForever>\r\n                    </td>\r\n                </tr>\r\n            )}\r\n            </tbody>\r\n        </table>\r\n        <Modal trigger={newRecordModal}>\r\n                <EditRecordForm \r\n                        UpdateForm={(payload: RecordFormType) => setFormData(payload)}\r\n                        closeForm={() => { setFormData({} as RecordFormType)\r\n                                        setNewRecordModal(false)}}\r\n                        handleSubmit={(e) => NewRecord(e)}\r\n                        type={type} formData={{...formData, id:undefined, type:type}}></EditRecordForm>\r\n        </Modal>\r\n        <Modal trigger={editModal}>\r\n                <EditRecordForm \r\n                UpdateForm={(payload:RecordFormType)=>setFormData(payload)} \r\n                formData={formData} \r\n                closeForm={() => { setFormData({} as RecordFormType)\r\n                                    setEditModal(false)}} \r\n                handleSubmit={(e)=>EditRecord(e) }  \r\n                type={type}></EditRecordForm>\r\n        </Modal>\r\n        <Modal trigger={deleteModal}>\r\n            <ConfirmDeleteForm \r\n                handleDelete={(e)=>handleDeleteSubmit(e)} \r\n                formData={formData} \r\n                close={()=>{setFormData({} as RecordFormType)\r\n                            setDeleteModal(false)}}></ConfirmDeleteForm>\r\n         </Modal>\r\n        </div>\r\n    \r\n        \r\n    </div>)\r\n}\r\n\r\n\r\nexport default CrudRecordTable;\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}