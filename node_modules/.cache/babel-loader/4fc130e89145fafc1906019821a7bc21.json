{"ast":null,"code":"import _asyncToGenerator from\"C:/Users/noah1/Documents/GitHub/Finances_app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/noah1/Documents/GitHub/Finances_app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\Users\\\\noah1\\\\Documents\\\\GitHub\\\\Finances_app\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useEffect,useState}from'react';import{Route,Routes,useLocation,useNavigate}from'react-router-dom';import'./App.css';import LoggedPage from'./components/logged_page/LoggedPage';import LoginPage from'./components/login_page/LoginPage';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var _useState=useState(''),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var location=useLocation();var navigate=useNavigate();var refreshSession=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,_token;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(\"\".concat(process.env.REACT_APP_PUBLIC_URL_API,\"/auth/session\"),{method:'POST',mode:'no-cors'});case 3:response=_context.sent;_context.next=6;return response.json();case 6:_token=_context.sent;_context.t0=setToken;_context.next=10;return _token.accessToken;case 10:_context.t1=_context.sent;(0,_context.t0)(_context.t1);_context.next=17;break;case 14:_context.prev=14;_context.t2=_context[\"catch\"](0);console.log(_context.t2);case 17:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function refreshSession(){return _ref.apply(this,arguments);};}();var isLogged=function isLogged(token){setToken(token);navigate(location.pathname,{replace:true});};useEffect(function(){//token refresh after 14min. the access token has a 15 min duration.\nvar refresh=setTimeout(refreshSession,1000*60*14);if(token===''){fetch(\"\".concat(process.env.REACT_APP_PUBLIC_URL_API,\"/auth/session\"),{method:'POST'}).then(function(res){return res.json();}).then(function(res){return res.accessToken!==undefined?isLogged(res.accessToken):navigate(\"\");}).catch(function(err){console.log(err);});}return function(){clearTimeout(refresh);};},[token]);return/*#__PURE__*/_jsx(\"div\",{className:\"App\",children:/*#__PURE__*/_jsxs(Routes,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",element:/*#__PURE__*/_jsx(LoginPage,{token:token,setAccessToken:function setAccessToken(payload){return setToken(payload);}})}),/*#__PURE__*/_jsx(Route,{path:\"/logged/*\",element:/*#__PURE__*/_jsx(LoggedPage,{token:token,setAccessToken:function setAccessToken(payload){return setToken(payload);}})})]})});}export default App;","map":{"version":3,"sources":["C:/Users/noah1/Documents/GitHub/Finances_app/src/App.tsx"],"names":["React","useEffect","useState","Route","Routes","useLocation","useNavigate","LoggedPage","LoginPage","App","token","setToken","location","navigate","refreshSession","fetch","process","env","REACT_APP_PUBLIC_URL_API","method","mode","response","json","accessToken","console","log","isLogged","pathname","replace","refresh","setTimeout","then","res","undefined","catch","err","clearTimeout","payload"],"mappings":"mZAEA,MAAOA,CAAAA,KAAP,EAAiBC,SAAjB,CAA4BC,QAA5B,KAA4C,OAA5C,CACA,OAASC,KAAT,CAAgBC,MAAhB,CAAwBC,WAAxB,CAAqCC,WAArC,KAAwD,kBAAxD,CACA,MAAO,WAAP,CACA,MAAOC,CAAAA,UAAP,KAAuB,qCAAvB,CACA,MAAOC,CAAAA,SAAP,KAAsB,mCAAtB,C,wFAIA,QAASC,CAAAA,GAAT,EAAe,CAGb,cAAyBP,QAAQ,CAAS,EAAT,CAAjC,wCAAOQ,KAAP,eAAaC,QAAb,eAEA,GAAMC,CAAAA,QAAQ,CAAGP,WAAW,EAA5B,CACA,GAAMQ,CAAAA,QAAQ,CAAGP,WAAW,EAA5B,CAMA,GAAMQ,CAAAA,cAAc,0FAAG,6LAEGC,CAAAA,KAAK,WAAIC,OAAO,CAACC,GAAR,CAAYC,wBAAhB,kBAAwD,CAACC,MAAM,CAAC,MAAR,CAAgBC,IAAI,CAAE,SAAtB,CAAxD,CAFR,QAEfC,QAFe,qCAGDA,CAAAA,QAAQ,CAACC,IAAT,EAHC,QAGfZ,MAHe,2BAKrBC,QALqB,wBAKLD,CAAAA,MAAK,CAACa,WALD,iJASrBC,OAAO,CAACC,GAAR,cATqB,qEAAH,kBAAdX,CAAAA,cAAc,0CAApB,CAkBC,GAAMY,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAAChB,KAAD,CAAiB,CAC9BC,QAAQ,CAACD,KAAD,CAAR,CACAG,QAAQ,CAACD,QAAQ,CAACe,QAAV,CAAoB,CAACC,OAAO,CAAE,IAAV,CAApB,CAAR,CACI,CAHR,CAMD3B,SAAS,CAAC,UAAI,CACZ;AACD,GAAM4B,CAAAA,OAAO,CAAGC,UAAU,CAAChB,cAAD,CAAgB,KAAK,EAAL,CAAQ,EAAxB,CAA1B,CACA,GAAGJ,KAAK,GAAG,EAAX,CAAc,CACdK,KAAK,WAAIC,OAAO,CAACC,GAAR,CAAYC,wBAAhB,kBAAwD,CAACC,MAAM,CAAC,MAAR,CAAxD,CAAL,CAA8EY,IAA9E,CAAmF,SAAAC,GAAG,QAAEA,CAAAA,GAAG,CAACV,IAAJ,EAAF,EAAtF,EACMS,IADN,CACW,SAAAC,GAAG,QAAEA,CAAAA,GAAG,CAACT,WAAJ,GAAkBU,SAAlB,CACTP,QAAQ,CAACM,GAAG,CAACT,WAAL,CADC,CAERV,QAAQ,IAFF,EADd,EAIQqB,KAJR,CAIc,SAAAC,GAAG,CAAE,CAACX,OAAO,CAACC,GAAR,CAAYU,GAAZ,EAAiB,CAJrC,EAIuC,CACtC,MAAO,WAAK,CACVC,YAAY,CAACP,OAAD,CAAZ,CACD,CAFD,CAGD,CAZQ,CAYP,CAACnB,KAAD,CAZO,CAAT,CAeA,mBACE,YAAK,SAAS,CAAC,KAAf,uBAEE,MAAC,MAAD,yBACA,KAAC,KAAD,EAAO,IAAI,CAAC,GAAZ,CAAgB,OAAO,cACtB,KAAC,SAAD,EAAW,KAAK,CAAEA,KAAlB,CAAyB,cAAc,CAAE,wBAAC2B,OAAD,QAAkB1B,CAAAA,QAAQ,CAAC0B,OAAD,CAA1B,EAAzC,EADD,EADA,cAIA,KAAC,KAAD,EAAO,IAAI,CAAC,WAAZ,CAAwB,OAAO,cAC9B,KAAC,UAAD,EAAY,KAAK,CAAE3B,KAAnB,CAA0B,cAAc,CAAE,wBAAC2B,OAAD,QAAkB1B,CAAAA,QAAQ,CAAC0B,OAAD,CAA1B,EAA1C,EADD,EAJA,GAFF,EADF,CAcD,CAED,cAAe5B,CAAAA,GAAf","sourcesContent":["\r\n\r\nimport React, {  useEffect, useState } from 'react';\r\nimport { Route, Routes, useLocation, useNavigate } from 'react-router-dom';\r\nimport './App.css';\r\nimport LoggedPage from './components/logged_page/LoggedPage';\r\nimport LoginPage from './components/login_page/LoginPage';\r\n\r\n\r\n\r\nfunction App() {\r\n\r\n\r\n  const [token,setToken] = useState<string>('')\r\n\r\n  const location = useLocation()\r\n  const navigate = useNavigate()\r\n\r\n\r\n  \r\n\r\n\r\n  const refreshSession = async()=>{\r\n   try{\r\n    const response =  await fetch(`${process.env.REACT_APP_PUBLIC_URL_API}/auth/session`,{method:'POST', mode: 'no-cors'})\r\n    const token = await response.json()\r\n   \r\n    setToken( await token.accessToken)\r\n   }catch(err){\r\n\r\n\r\n    console.log(err)\r\n\r\n   }\r\n\r\n  \r\n\r\n }\r\n\r\n \r\n   const isLogged = (token:string) =>{\r\n       setToken(token)\r\n       navigate(location.pathname, {replace: true})\r\n          }\r\n\r\n\r\n  useEffect(()=>{\r\n    //token refresh after 14min. the access token has a 15 min duration.\r\n   const refresh = setTimeout(refreshSession,1000*60*14)\r\n   if(token===''){\r\n   fetch(`${process.env.REACT_APP_PUBLIC_URL_API}/auth/session`,{method:'POST'}).then(res=>res.json())\r\n        .then(res=>res.accessToken!==undefined?\r\n          isLogged(res.accessToken)\r\n          :navigate(``))\r\n          .catch(err=>{console.log(err)})}\r\n    return () =>{\r\n      clearTimeout(refresh)\r\n    }\r\n  },[token])\r\n\r\n\r\n  return (\r\n    <div className=\"App\">\r\n  \r\n      <Routes>\r\n      <Route path='/' element={\r\n       <LoginPage token={token} setAccessToken={(payload:string)=>setToken(payload) }></LoginPage>}>\r\n       </Route>\r\n      <Route path='/logged/*' element={\r\n       <LoggedPage token={token} setAccessToken={(payload:string)=>setToken(payload) }></LoggedPage>}>\r\n      </Route>\r\n      </Routes>\r\n\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n"]},"metadata":{},"sourceType":"module"}